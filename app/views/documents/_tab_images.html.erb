<!-- 添付画像タブ -->
<div id="content3" class="tab-content">
  <div class="form-group btn-l">
    <!-- カメラ起動ボタン -->
    <div class="btn" onclick="document.getElementById('camera-input').click()">
      カメラを起動して撮影
    </div>
    <input id="camera-input" type="file" accept="image/*" capture="environment" hidden>

    <!-- フォルダ起動ボタン -->
    <%= form_with url: upload_image_document_path(@document), multipart: true, local: true, id: "upload-form" do %>
      <div class="btn-l">
        <div class="btn file-btn" onclick="document.getElementById('auto-upload-input').click()">
         ファイルを選択
        </div>
        <span id="file-name" class="file-name">選択されていません</span>
        <input type="file" name="images[]" id="auto-upload-input" accept="image/*" multiple hidden>
        <%= submit_tag "アップロード", class: "btn" %>
      <% end %>
    </div>
  </div>

  <% if @document.images.attached? %>
    <div class="thumbnail-gallery">
      <% @document.images.each do |image| %>
        <div class="thumbnail-item">
          <%= image_tag image.variant(resize_to_limit: [80, 80]).processed, alt: "添付画像", class: "thumbnail", onclick: "openModal('#{url_for(image)}')" %>

          <%= button_to delete_image_document_path(@document, image_id: image.id), method: :delete, data: { confirm: "この画像を削除しますか？" }, class: "delete-thumb-btn" do %>
            削除
          <% end %>
        </div>
      <% end %>
    </div>
    <!-- 保管期限設定ボタン -->
    <div class="btn-l">
      <div id="expiry-button" class="btn" onclick="openExpiryModal()">
        保管期限を設定
      </div>
    </div>
  <% else %>
    <p>まだ画像が登録されていません。</p>
    <p>画像を追加してみましょう！</p>
  <% end %>
</div>

<!-- モーダル -->
<div id="image-modal" class="modal" style="display:none;">
  <span class="close" onclick="closeModal()">&times;</span>
  <img class="modal-content" id="modal-image">
</div>

<!-- 保管期限設定モーダル -->
<div id="expiry-modal" class="expiry-modal" style="display: none;">
  <div class="expiry-box">
    <span id="expiry-close" class="close" onclick="closeExpiryModal()">&times;</span>
    <p class="expiry-title">保管期限を変更する</p>

    <!-- 現在の保管期限表示 -->
    <p id="current-expiry">
      現在の保管期限：
      <%= @document.expires_at.present? ? @document.expires_at.strftime("%Y/%m/%d") : "無期限" %>
    </p>
    <p>保管期限を選んでください</p>
    <p class="bodysm-s">あとから変更することも可能です</p>

    <%= form_with url: update_expiry_document_path(@document), method: :patch, local: true do |form| %>
      <div class="expiry-option">
        <%= form.radio_button :expires_at, nil, checked: true, id: "expiry_radio_none", name: "expiry_option" %>
        <p class="expiry-text" data-radio="expiry_radio_none">無期限</p>
      </div>
      
      <div class="expiry-option">
        <%= form.radio_button :expires_at, 6.months.from_now, id: "expiry_radio_6m", name: "expiry_option" %>
        <p class="expiry-text" data-radio="expiry_radio_6m">6か月後</p>
      </div>
      
      <div class="expiry-option">
        <%= form.radio_button :expires_at, 1.year.from_now, id: "expiry_radio_1y", name: "expiry_option" %>
        <p class="expiry-text" data-radio="expiry_radio_1y">1年後</p>
      </div>
      
      <div class="expiry-btns">
        <button type="button" class="btn cancel-btn" onclick="closeExpiryModal()">キャンセルする</button>
        <%= form.submit "保存する", class: "btn" %>
      </div>
    <% end %>
  </div>
</div>